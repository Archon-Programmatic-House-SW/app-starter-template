üöÄ Archon Application Starter TemplateWelcome to the Archon Golden Path. This repository serves as the foundational template for all new microservices at Archon-Programmatic-House-SW.By using this template, you automatically inherit a secure, fully configured CI/CD pipeline that adheres to our DevOps standards without writing complex infrastructure code.‚ùì Why use this template?Instead of spending days configuring GitHub Actions, GCP Authentication, Docker builds, and Cloud Run deployments, this template provides them out-of-the-box.Standardized Security: Uses Workload Identity Federation (WIF) so you never handle long-lived JSON keys.Separation of Duties: Separates the Builder Identity (CI/CD) from the Runtime Identity (The actual App).Environment Parity: Uses the exact same deployment logic for Development and Production, differing only by configuration.Automated Versioning: Includes tools to handle Semantic Versioning (v1.0.0) automatically.üì¶ How to use this template (Getting Started)1. Create your RepoClick the green "Use this template" button at the top of this repository and select "Create a new repository". Name your repository (e.g., user-service, payment-api).2. Configure Your ServiceYou need to update the configuration to match your specific service. Open the .github/workflows/ directory and edit the following files:A. Development Pipeline (dev-pipeline.yml)Trigger: Pushes to the develop branch.Action: 1. Find service_name: test-service and change it to your service name.2. Update runtime_service_account to the email of the Service Account your app should use at runtime.3. Uncomment and configure env_vars if your app needs environment variables.4. Add Tests: Look for the test-and-verify job. Add your specific test commands (e.g., npm test, pytest, dotnet test).B. Production Release (prod-release.yml)Trigger: Creation of a git tag (e.g., v1.0.1).Action:Find service_name and update it.Update project_id if Production lives in a different GCP project.Update runtime_service_account (Production usually has a different SA identity).üîÑ The Workflows ExplainedThis template comes with three distinct workflows designed to work together.1. Development Pipeline (dev-pipeline.yml)When it runs: Every time you push code to the develop branch.What it does:Test & Verify: Runs your unit tests inside the GitHub Runner. If these fail, the deployment stops.Deploy to Dev: Calls the central devops-templates repository. It builds your container, pushes it to Artifact Registry, and deploys to Cloud Run in the Development environment.2. Create Release Tag (create-release-tag.yml)When it runs: Manually triggered via the "Actions" tab in GitHub.What it does:You select the release type: patch, minor, or major.It calculates the next version number based on previous tags.It creates a new Git Tag (e.g., v1.2.0) and pushes it to the repo using a special Bot Token (GH_PAT_TAG).Crucial: This push action automatically triggers the Production Release workflow.3. Production Release (prod-release.yml)When it runs: Automatically when a tag starting with v* is pushed.What it does:Verify Release: Checks changelogs or performs sanity checks (optional).Deploy to Prod: Calls the central devops-templates repository. It deploys the exact code associated with that tag to the Production environment.üîê Secrets & PermissionsThis template relies on Organization Level Secrets managed by the DevOps team. You generally do not need to configure secrets in your specific repo unless your app has unique private keys.Secret NameLevelDescriptionORG_WIF_PROVIDEROrgConnects GitHub to GCP without keys.ORG_CI_BUILDER_EMAILOrgThe Service Account that executes the build/deploy.GH_PAT_TAGOrgPersonal Access Token used to push tags and trigger Prod.üõ† Troubleshooting"Production didn't trigger after I created a tag":Did you create the tag using the manual workflow? If you manually pushed a tag from your local terminal using git push --tags, ensure you are using a token that triggers workflows, or use the provided Create Release Tag workflow."Permission Denied during Deploy":Check that the runtime_service_account you specified in the YAML exists in GCP and the ORG_CI_BUILDER_EMAIL has permission to actAs that runtime account.
